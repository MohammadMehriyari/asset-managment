<as-header></as-header>
<div class="address">
  <a routerLink="/panel">صفحه اصلی </a>
  <span>&nbsp;/&nbsp;</span>

  <a routerLink="/computer"> لیست کامپیوترها</a>
</div>
<div>
  <button
    class="btn btn-primary rounded-pill px-3"
    style="float: right; margin-right: 10px"
    (click)="toggleView('form')"
  >
    ایجاد کامپیوتر جدید
  </button>
</div>
<div class="message-container" *ngIf="showMessage">
  <div class="success" *ngIf="successMessage">{{ successMessage }}</div>
  <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
</div>
<div class="userPc-form" *ngIf="showUserPcForm">
  <form [formGroup]="userPcForm" (ngSubmit)="submitUserPc()">
    <div class="container1">
      <div class="row">
        <div class="form-group">
          <label class="os-label" style="width: 90px" for="ownerUserId">
            کاربر
          </label>
          <p-dropdown
            [options]="userList"
            optionLabel="userlastname"
            formControlName="ownerUserId"
            optionValue="userid"
            [filter]="true"
            [showClear]="true"
            filterPlaceholder="جستجو"
            styleClass="prime-dropdown"
          >
            <ng-template let-user pTemplate="item">
              <span>{{ user.username }} {{ user.userlastname }}</span>
            </ng-template></p-dropdown
          >
        </div>

        <!-- <div class="form-group">
          <label style="width: 90px" for="ownerUserId">کاربر </label>
          <select
            id="ownerUserId"
            class="select1"
            formControlName="ownerUserId"
          >
            >
            <option selected>انتخاب کنید</option>
            <option *ngFor="let user of userList" [value]="user.userid">
              {{ user.username }} {{ user.userlastname }}
            </option>
          </select>
        </div> -->
      </div>
      <div class="row">
        <!-- <div class="form-group">
          <label class="label" style="width: 90px" for="buildingId"
            >ساختمان</label
          >
          <p-dropdown
            [options]="buildingList"
            optionLabel="buildingname"
            formControlName="buildingId"
            optionValue="buildingid"
            filter="true"
            showClear="true"
            filterPlaceholder="جستجو"
            styleClass="prime-dropdown"
          ></p-dropdown>
        </div> -->

        <div class="form-group">
          <label style="width: 90px" for="buildingId">ساختمان </label>
          <select id="buildingId" class="select1" formControlName="buildingId">
            >
            <option selected>انتخاب کنید</option>
            <option
              *ngFor="let building of buildingList"
              [value]="building.buildingid"
            >
              {{ building.buildingname }}
            </option>
          </select>
        </div>
      </div>
      <div class="row">
        <!-- <div class="form-group">
          <label class="label" style="width: 90px" for="areaId">
            سیستم عامل</label
          >
          <p-dropdown
            [options]="areaList"
            optionLabel="areaname"
            formControlName="areaId"
            optionValue="areaid"
            [filter]="true"
            [showClear]="true"
            filterPlaceholder="جستجو"
            styleClass="prime-dropdown"
          ></p-dropdown>
        </div> -->

        <div class="form-group">
          <label style="width: 90px" for="areaId">حوزه </label>
          <select id="areaId" class="select1" formControlName="areaId">
            >
            <option selected>انتخاب کنید</option>
            <option *ngFor="let area of areaList" [value]="area.areaid">
              {{ area.areaname }}
            </option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="passButtons">
          <button
            type="submit"
            class="btn btn-primary"
            style="width: 30%; margin-right: 10px"
          >
            تایید
          </button>
          <button
            type="button"
            class="btn btn-danger"
            style="width: 30%"
            (click)="closeUserPcForm()"
          >
            بستن
          </button>
        </div>
      </div>
    </div>
  </form>
</div>
<div>
  <form
    class="form1"
    *ngIf="showComputerForm"
    [formGroup]="computerForm"
    (ngSubmit)="onSubmitComputerForm()"
  >
    <div class="container2">
      <div class="sub1">
        <div class="sub1 gp1">
          <div class="col-md-6">
            <div class="form-group">
              <!-- حتما intger باشد -->
              <label for="computerpropertynumber"> شماره اموال</label>
              <input
                dir="rtl"
                type="text"
                id="computerpropertynumber"
                class="form-control"
                formControlName="computerpropertynumber"
                required
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="computername"> نام</label>
              <input
                dir="rtl"
                type="text"
                id="computername"
                class="form-control"
                formControlName="computername"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="computermodel"> مدل </label>
              <input
                dir="rtl"
                type="text"
                id="computermodel"
                class="form-control"
                formControlName="computermodel"
              />
            </div>
          </div>
        </div>
        <div class="sub1 gp2">
          <div class="col-md-6">
            <div class="form-group">
              <label for="computerip"> IP </label>
              <input
                dir="rtl"
                type="text"
                id="computerip"
                class="form-control"
                formControlName="computerip"
                placeholder="حداکثر 15 رقم"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="computermacaddress"> MacAddress</label>
              <input
                dir="rtl"
                type="text"
                id="computermacaddress"
                class="form-control"
                formControlName="computermacaddress"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="computerispersonal"> مالکیت</label>
              <select
                id="computerispersonal"
                class="select1"
                formControlName="computerispersonal"
              >
                <option value="0">شخصی است</option>
                <option value="1">شخصی نیست</option>
              </select>
            </div>
          </div>
        </div>
        <div class="sub1 gp3">
          <div class="col-md-6">
            <div class="form-group">
              <label class="os-label" style="width: 120px" for="osName">
                سیستم عامل</label
              >
              <p-dropdown
                [options]="osList"
                optionLabel="operationsystemname"
                formControlName="osName"
                optionValue="operationsystemid"
                [filter]="true"
                [showClear]="true"
                filterPlaceholder="جستجو"
                styleClass="prime-dropdown"
                (onChange)="onOsNameChange($event)"
              ></p-dropdown>
            </div>
          </div>
          <!-- <div class="col-md-6">
            <div class="form-group">
              <label class="os-label" style="width: 120px" for="osName">
                سیستم عامل</label
              >
              <select
                id="osName"
                class="select1"
                formControlName="osName"
                (change)="onOsNameChange($event)"
              >
                <option
                  *ngFor="let os of osList"
                  [value]="os.operationsystemid"
                >
                  {{ os.operationsystemname }}
                </option>
              </select>
            </div>
          </div> -->
          <div class="col-md-6">
            <div class="form-group">
              <label class="os-label" style="width: 160px" for="osVersionId">
                ورژن سیستم عامل
              </label>
              <p-dropdown
                [options]="selectedOsVersions"
                optionLabel="operationsystemversionname"
                formControlName="osVersionId"
                optionValue="operationsystemversionid"
                [filter]="true"
                [showClear]="true"
                filterPlaceholder="جستجو"
                styleClass="prime-dropdown"
              ></p-dropdown>
            </div>
          </div>
          <!-- <div class="col-md-6">
            <div class="form-group">
              <label class="os-label" style="width: 160px" for="osVersionId">
                ورژن سیستم عامل</label
              >
              <select
                id="osVersionId"
                class="select1"
                formControlName="osVersionId"
              >
                <option
                  *ngFor="let version of selectedOsVersions"
                  [value]="version.operationsystemversionid"
                >
                  {{ version.operationsystemversionname }}
                </option>
              </select>
            </div>
          </div> -->
        </div>
      </div>
      <div class="buttons2">
        <button type="submit" class="btn btn-primary">
          {{ this.isEditing ? "ویرایش" : "ثبت" }}
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="closeComputerForm()"
        >
          بستن
        </button>
      </div>
    </div>
  </form>

  <!-- Computer Table -->
  <div class="mat-elevation-z8" *ngIf="showComputerTable">
    <!-- <mat-form-field>
      <mat-label>فیلتر</mat-label>
      <input
        matInput
        (keyup)="applyFilter($event)"
        placeholder="اداری"
        #input
      />
    </mat-form-field> -->
    <table
      mat-table
      [dataSource]="ComputerDataSource"
      matSort
      [dir]="'rtl'"
      class="full-width-table"
    >
      <!-- Computer Property Number Column -->
      <ng-container matColumnDef="computerpropertynumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>شماره اموال</th>
        <td mat-cell *matCellDef="let row">
          {{ row?.computerpropertynumber }}
        </td>
      </ng-container>

      <!-- Computer Name Column -->
      <ng-container matColumnDef="computername">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>نام کامپیوتر</th>
        <td mat-cell *matCellDef="let row">{{ row?.computername }}</td>
      </ng-container>
      <!-- Computer Model Column -->
      <ng-container matColumnDef="computermodel">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>مدل کامپیوتر</th>
        <td mat-cell *matCellDef="let row">{{ row?.computermodel }}</td>
      </ng-container>
      <!-- Computer Ip Column -->
      <ng-container matColumnDef="computerip">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>IP</th>
        <td mat-cell *matCellDef="let row">{{ row?.computerip }}</td>
      </ng-container>
      <!-- Computer Mac Column -->
      <ng-container matColumnDef="computermacaddress">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Mac Address</th>
        <td mat-cell *matCellDef="let row">{{ row?.computermacaddress }}</td>
      </ng-container>
      <!-- Computer Op Column -->
      <ng-container matColumnDef="osName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>سیستم عامل</th>
        <td mat-cell *matCellDef="let row">
          {{ row?.operationsystemversionid.operationsystemname }}
        </td>
      </ng-container>
      <!-- Computer Op Version Column -->
      <ng-container matColumnDef="osVersionId">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          نسخه سیستم عامل
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row?.operationsystemversionid?.operationsystemversionname }}
        </td>
      </ng-container>

      <!-- Computer Ownership Version Column -->
      <ng-container matColumnDef="computerispersonal">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>وضعیت مالکیت</th>
        <td mat-cell *matCellDef="let row">
          {{ getPersonalStatus(row?.computerispersonal) }}
        </td>
      </ng-container>
      <!-- Computer Sealling Version Column -->
      <ng-container matColumnDef="computersealling">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>شماره پلمپ</th>
        <td mat-cell *matCellDef="let row">
          {{ row?.sealing?.computerseallingnumber || "(خالی)" }}
        </td>
      </ng-container>
      <!-- User Button Column -->
      <ng-container matColumnDef="userPc">
        <th mat-header-cell *matHeaderCellDef>تحویل کامپیوتر</th>
        <td mat-cell *matCellDef="let row">
          <button
            [disabled]="row.isAbortion"
            class="btn btn-primary"
            (click)="
              openUserPcForm(
                row?.computerpropertynumber,
                row?.sealing?.computerseallingnumber || null
              )
            "
          >
            تحویل
          </button>
        </td>
      </ng-container>
      <ng-container matColumnDef="viewUser">
        <th mat-header-cell *matHeaderCellDef>کاربر</th>
        <td mat-cell *matCellDef="let row">
          <button
            [disabled]="row.isAbortion"
            class="btn btn-info"
            (click)="viewUser(row?.computerpropertynumber)"
          >
            مشاهده
          </button>
        </td>
      </ng-container>
      <ng-container matColumnDef="viewDetail">
        <th mat-header-cell *matHeaderCellDef>اطلاعات</th>
        <td mat-cell *matCellDef="let row">
          <button
            class="btn btn-info"
            (click)="viewDetail(row?.computerpropertynumber)"
          >
            مشاهده
          </button>
        </td>
      </ng-container>
      <!-- Edit button column  -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>ویرایش</th>
        <td mat-cell *matCellDef="let row">
          <button
            [disabled]="row.isAbortion"
            class="btn btn-primary"
            style="width: 76px"
            (click)="editComputer(row?.computerpropertynumber)"
          >
            ویرایش
          </button>
        </td>
      </ng-container>
      <!-- Delete Button Column -->
      <ng-container matColumnDef="delete">
        <th mat-header-cell *matHeaderCellDef>حذف</th>
        <td mat-cell *matCellDef="let row">
          <button
            [disabled]="row.isAbortion"
            class="btn btn-danger"
            style="width: 76px"
            (click)="deleteComputer(row?.computerpropertynumber)"
          >
            حذف
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 25, 100]"
      aria-label="Select page of buildings"
    ></mat-paginator>
  </div>
  <div
    class="backdrop"
    *ngIf="showUserPcForm"
    (click)="closeUserPcForm()"
  ></div>
</div>
